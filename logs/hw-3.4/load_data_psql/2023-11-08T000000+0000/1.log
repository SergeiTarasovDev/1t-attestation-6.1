[2023-12-02 15:35:09,894] {{taskinstance.py:670}} INFO - Dependencies all met for <TaskInstance: hw-3.4.load_data_psql 2023-11-08T00:00:00+00:00 [queued]>
[2023-12-02 15:35:10,021] {{taskinstance.py:670}} INFO - Dependencies all met for <TaskInstance: hw-3.4.load_data_psql 2023-11-08T00:00:00+00:00 [queued]>
[2023-12-02 15:35:10,023] {{taskinstance.py:880}} INFO - 
--------------------------------------------------------------------------------
[2023-12-02 15:35:10,024] {{taskinstance.py:881}} INFO - Starting attempt 1 of 1
[2023-12-02 15:35:10,026] {{taskinstance.py:882}} INFO - 
--------------------------------------------------------------------------------
[2023-12-02 15:35:10,051] {{taskinstance.py:901}} INFO - Executing <Task(PythonOperator): load_data_psql> on 2023-11-08T00:00:00+00:00
[2023-12-02 15:35:10,059] {{standard_task_runner.py:54}} INFO - Started process 250 to run task
[2023-12-02 15:35:10,153] {{standard_task_runner.py:77}} INFO - Running: ['airflow', 'run', 'hw-3.4', 'load_data_psql', '2023-11-08T00:00:00+00:00', '--job_id', '18', '--pool', 'default_pool', '--raw', '-sd', 'DAGS_FOLDER/hw-3.4.py', '--cfg_path', '/tmp/tmpyiked1py']
[2023-12-02 15:35:10,156] {{standard_task_runner.py:78}} INFO - Job 18: Subtask load_data_psql
[2023-12-02 15:35:10,215] {{logging_mixin.py:120}} INFO - Running <TaskInstance: hw-3.4.load_data_psql 2023-11-08T00:00:00+00:00 [running]> on host 742d4d2983a3
[2023-12-02 15:35:10,252] {{base_hook.py:89}} INFO - Using connection to: id: conn1. Host: host.docker.internal, Port: 5434, Schema: quotes, Login: postgres, Password: XXXXXXXX, extra: None
[2023-12-02 15:35:11,144] {{logging_mixin.py:120}} INFO - ------------ response --------------
[2023-12-02 15:35:11,145] {{logging_mixin.py:120}} INFO - http://api.exchangerate.host/timeframe?access_key=9320603ab554ad114bd43b3d4b5905c0&start_date=2022-12-10&end_date=2023-12-02&currencies=USD
[2023-12-02 15:35:11,147] {{logging_mixin.py:120}} INFO - None
[2023-12-02 15:35:11,149] {{logging_mixin.py:120}} INFO - {'User-Agent': 'python-requests/2.23.0', 'Accept-Encoding': 'gzip, deflate', 'Accept': '*/*', 'Connection': 'keep-alive'}
[2023-12-02 15:35:11,150] {{logging_mixin.py:120}} INFO - ------------ end --------------
[2023-12-02 15:35:11,152] {{logging_mixin.py:120}} INFO - ------------ data --------------
[2023-12-02 15:35:11,154] {{logging_mixin.py:120}} INFO - {'success': True, 'terms': 'https://currencylayer.com/terms', 'privacy': 'https://currencylayer.com/privacy', 'timeframe': True, 'start_date': '2022-12-10', 'end_date': '2023-12-02', 'source': 'USD', 'quotes': {'2022-12-10': [], '2022-12-11': [], '2022-12-12': [], '2022-12-13': [], '2022-12-14': [], '2022-12-15': [], '2022-12-16': [], '2022-12-17': [], '2022-12-18': [], '2022-12-19': [], '2022-12-20': [], '2022-12-21': [], '2022-12-22': [], '2022-12-23': [], '2022-12-24': [], '2022-12-25': [], '2022-12-26': [], '2022-12-27': [], '2022-12-28': [], '2022-12-29': [], '2022-12-30': [], '2022-12-31': [], '2023-01-01': [], '2023-01-02': [], '2023-01-03': [], '2023-01-04': [], '2023-01-05': [], '2023-01-06': [], '2023-01-07': [], '2023-01-08': [], '2023-01-09': [], '2023-01-10': [], '2023-01-11': [], '2023-01-12': [], '2023-01-13': [], '2023-01-14': [], '2023-01-15': [], '2023-01-16': [], '2023-01-17': [], '2023-01-18': [], '2023-01-19': [], '2023-01-20': [], '2023-01-21': [], '2023-01-22': [], '2023-01-23': [], '2023-01-24': [], '2023-01-25': [], '2023-01-26': [], '2023-01-27': [], '2023-01-28': [], '2023-01-29': [], '2023-01-30': [], '2023-01-31': [], '2023-02-01': [], '2023-02-02': [], '2023-02-03': [], '2023-02-04': [], '2023-02-05': [], '2023-02-06': [], '2023-02-07': [], '2023-02-08': [], '2023-02-09': [], '2023-02-10': [], '2023-02-11': [], '2023-02-12': [], '2023-02-13': [], '2023-02-14': [], '2023-02-15': [], '2023-02-16': [], '2023-02-17': [], '2023-02-18': [], '2023-02-19': [], '2023-02-20': [], '2023-02-21': [], '2023-02-22': [], '2023-02-23': [], '2023-02-24': [], '2023-02-25': [], '2023-02-26': [], '2023-02-27': [], '2023-02-28': [], '2023-03-01': [], '2023-03-02': [], '2023-03-03': [], '2023-03-04': [], '2023-03-05': [], '2023-03-06': [], '2023-03-07': [], '2023-03-08': [], '2023-03-09': [], '2023-03-10': [], '2023-03-11': [], '2023-03-12': [], '2023-03-13': [], '2023-03-14': [], '2023-03-15': [], '2023-03-16': [], '2023-03-17': [], '2023-03-18': [], '2023-03-19': [], '2023-03-20': [], '2023-03-21': [], '2023-03-22': [], '2023-03-23': [], '2023-03-24': [], '2023-03-25': [], '2023-03-26': [], '2023-03-27': [], '2023-03-28': [], '2023-03-29': [], '2023-03-30': [], '2023-03-31': [], '2023-04-01': [], '2023-04-02': [], '2023-04-03': [], '2023-04-04': [], '2023-04-05': [], '2023-04-06': [], '2023-04-07': [], '2023-04-08': [], '2023-04-09': [], '2023-04-10': [], '2023-04-11': [], '2023-04-12': [], '2023-04-13': [], '2023-04-14': [], '2023-04-15': [], '2023-04-16': [], '2023-04-17': [], '2023-04-18': [], '2023-04-19': [], '2023-04-20': [], '2023-04-21': [], '2023-04-22': [], '2023-04-23': [], '2023-04-24': [], '2023-04-25': [], '2023-04-26': [], '2023-04-27': [], '2023-04-28': [], '2023-04-29': [], '2023-04-30': [], '2023-05-01': [], '2023-05-02': [], '2023-05-03': [], '2023-05-04': [], '2023-05-05': [], '2023-05-06': [], '2023-05-07': [], '2023-05-08': [], '2023-05-09': [], '2023-05-10': [], '2023-05-11': [], '2023-05-12': [], '2023-05-13': [], '2023-05-14': [], '2023-05-15': [], '2023-05-16': [], '2023-05-17': [], '2023-05-18': [], '2023-05-19': [], '2023-05-20': [], '2023-05-21': [], '2023-05-22': [], '2023-05-23': [], '2023-05-24': [], '2023-05-25': [], '2023-05-26': [], '2023-05-27': [], '2023-05-28': [], '2023-05-29': [], '2023-05-30': [], '2023-05-31': [], '2023-06-01': [], '2023-06-02': [], '2023-06-03': [], '2023-06-04': [], '2023-06-05': [], '2023-06-06': [], '2023-06-07': [], '2023-06-08': [], '2023-06-09': [], '2023-06-10': [], '2023-06-11': [], '2023-06-12': [], '2023-06-13': [], '2023-06-14': [], '2023-06-15': [], '2023-06-16': [], '2023-06-17': [], '2023-06-18': [], '2023-06-19': [], '2023-06-20': [], '2023-06-21': [], '2023-06-22': [], '2023-06-23': [], '2023-06-24': [], '2023-06-25': [], '2023-06-26': [], '2023-06-27': [], '2023-06-28': [], '2023-06-29': [], '2023-06-30': [], '2023-07-01': [], '2023-07-02': [], '2023-07-03': [], '2023-07-04': [], '2023-07-05': [], '2023-07-06': [], '2023-07-07': [], '2023-07-08': [], '2023-07-09': [], '2023-07-10': [], '2023-07-11': [], '2023-07-12': [], '2023-07-13': [], '2023-07-14': [], '2023-07-15': [], '2023-07-16': [], '2023-07-17': [], '2023-07-18': [], '2023-07-19': [], '2023-07-20': [], '2023-07-21': [], '2023-07-22': [], '2023-07-23': [], '2023-07-24': [], '2023-07-25': [], '2023-07-26': [], '2023-07-27': [], '2023-07-28': [], '2023-07-29': [], '2023-07-30': [], '2023-07-31': [], '2023-08-01': [], '2023-08-02': [], '2023-08-03': [], '2023-08-04': [], '2023-08-05': [], '2023-08-06': [], '2023-08-07': [], '2023-08-08': [], '2023-08-09': [], '2023-08-10': [], '2023-08-11': [], '2023-08-12': [], '2023-08-13': [], '2023-08-14': [], '2023-08-15': [], '2023-08-16': [], '2023-08-17': [], '2023-08-18': [], '2023-08-19': [], '2023-08-20': [], '2023-08-21': [], '2023-08-22': [], '2023-08-23': [], '2023-08-24': [], '2023-08-25': [], '2023-08-26': [], '2023-08-27': [], '2023-08-28': [], '2023-08-29': [], '2023-08-30': [], '2023-08-31': [], '2023-09-01': [], '2023-09-02': [], '2023-09-03': [], '2023-09-04': [], '2023-09-05': [], '2023-09-06': [], '2023-09-07': [], '2023-09-08': [], '2023-09-09': [], '2023-09-10': [], '2023-09-11': [], '2023-09-12': [], '2023-09-13': [], '2023-09-14': [], '2023-09-15': [], '2023-09-16': [], '2023-09-17': [], '2023-09-18': [], '2023-09-19': [], '2023-09-20': [], '2023-09-21': [], '2023-09-22': [], '2023-09-23': [], '2023-09-24': [], '2023-09-25': [], '2023-09-26': [], '2023-09-27': [], '2023-09-28': [], '2023-09-29': [], '2023-09-30': [], '2023-10-01': [], '2023-10-02': [], '2023-10-03': [], '2023-10-04': [], '2023-10-05': [], '2023-10-06': [], '2023-10-07': [], '2023-10-08': [], '2023-10-09': [], '2023-10-10': [], '2023-10-11': [], '2023-10-12': [], '2023-10-13': [], '2023-10-14': [], '2023-10-15': [], '2023-10-16': [], '2023-10-17': [], '2023-10-18': [], '2023-10-19': [], '2023-10-20': [], '2023-10-21': [], '2023-10-22': [], '2023-10-23': [], '2023-10-24': [], '2023-10-25': [], '2023-10-26': [], '2023-10-27': [], '2023-10-28': [], '2023-10-29': [], '2023-10-30': [], '2023-10-31': [], '2023-11-01': [], '2023-11-02': [], '2023-11-03': [], '2023-11-04': [], '2023-11-05': [], '2023-11-06': [], '2023-11-07': [], '2023-11-08': [], '2023-11-09': [], '2023-11-10': [], '2023-11-11': [], '2023-11-12': [], '2023-11-13': [], '2023-11-14': [], '2023-11-15': [], '2023-11-16': [], '2023-11-17': [], '2023-11-18': [], '2023-11-19': [], '2023-11-20': [], '2023-11-21': [], '2023-11-22': [], '2023-11-23': [], '2023-11-24': [], '2023-11-25': [], '2023-11-26': [], '2023-11-27': [], '2023-11-28': [], '2023-11-29': [], '2023-11-30': [], '2023-12-01': [], '2023-12-02': []}}
[2023-12-02 15:35:11,157] {{logging_mixin.py:120}} INFO - ------------ end --------------
[2023-12-02 15:35:11,159] {{taskinstance.py:1150}} ERROR - Ошибка записи данных: 'timestamp'
Traceback (most recent call last):
  File "/usr/local/airflow/dags/modules/functions.py", line 48, in load_data_psql
    get_date = datetime.utcfromtimestamp(data["timestamp"]).strftime('%Y-%m-%d %H:%M:%S')
KeyError: 'timestamp'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.7/site-packages/airflow/models/taskinstance.py", line 984, in _run_raw_task
    result = task_copy.execute(context=context)
  File "/usr/local/lib/python3.7/site-packages/airflow/operators/python_operator.py", line 113, in execute
    return_value = self.execute_callable()
  File "/usr/local/lib/python3.7/site-packages/airflow/operators/python_operator.py", line 118, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/usr/local/airflow/dags/modules/functions.py", line 61, in load_data_psql
    raise Exception(f'Ошибка записи данных: {error}')
Exception: Ошибка записи данных: 'timestamp'
[2023-12-02 15:35:11,166] {{taskinstance.py:1194}} INFO - Marking task as FAILED. dag_id=hw-3.4, task_id=load_data_psql, execution_date=20231108T000000, start_date=20231202T153509, end_date=20231202T153511
[2023-12-02 15:35:14,849] {{local_task_job.py:102}} INFO - Task exited with return code 1
